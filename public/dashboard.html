<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>US Embassy Visa Appointment Portal</title>
  <link rel="stylesheet" href="styles.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <div id="app-root" class="app-root">
    <div class="card embassy-dashboard">
      <div class="embassy-header">
        <h2>Visa Appointment System</h2>
        <div class="embassy-session-info">
          <span class="session-badge active">‚óè Session Active</span>
          <span id="session-timer">Time: <span id="time-remaining">--:--</span></span>
          <button id="logout-btn" class="btn-link">Logout</button>
        </div>
      </div>

      <div class="filters">
        <div class="form-group">
          <label>Visa Type</label>
          <select id="visa-type-select">
            <option value="Tourist" selected>Tourist</option>
            <option value="Student">Student</option>
            <option value="Work">Work</option>
            <option value="Visit">Visit</option>
          </select>
        </div>
        <div class="form-group">
          <label>Center</label>
          <select id="center-select">
            <option value="DXB" selected>Dubai (DXB)</option>
            <option value="AUH">Abu Dhabi (AUH)</option>
            <option value="ISB">Islamabad (ISB)</option>
            <option value="LHR">Lahore (LHR)</option>
          </select>
        </div>
        <button id="check-appointments-btn" class="btn secondary">
          Check Appointments
        </button>
      </div>

      <div id="embassy-calendar-wrapper" class="embassy-wrapper">
        <div class="calendar-section">
          <div class="calendar-header">
            <button id="prev-month-btn" class="link-btn">&#8249; Previous</button>
            <div id="calendar-month-label"></div>
            <button id="next-month-btn" class="link-btn">Next &#8250;</button>
          </div>
          
          <div id="calendar-loading" class="calendar-loading">
            <div class="embassy-spinner"></div>
            <p>Loading appointment availability...</p>
          </div>
          
          <div id="appointment-calendar" class="hidden">
            <table id="embassy-calendar" class="embassy-calendar-table">
              <thead>
                <tr>
                  <th>Mon</th>
                  <th>Tue</th>
                  <th>Wed</th>
                  <th>Thu</th>
                  <th>Fri</th>
                  <th>Sat</th>
                  <th>Sun</th>
                </tr>
              </thead>
              <tbody>
                <!-- Dynamically filled by AJAX -->
              </tbody>
            </table>
          </div>
          
          <div class="legend">
            <span class="legend-item available">Available</span>
            <span class="legend-item na">Not Available</span>
            <span class="legend-item full">Full</span>
            <span class="legend-item holiday">Holiday</span>
          </div>
        </div>
      </div>

      <div id="session-expired-popup" class="session-popup hidden">
        <div class="session-popup-inner">
          <h3>Session Expired</h3>
          <p>Your session has expired. Please sign in again.</p>
          <button id="session-expired-ok-btn" class="btn primary">Sign In Again</button>
        </div>
      </div>
    </div>

    <!-- Developer Debug Panel -->
    <div id="embassy-debug-panel" class="debug-panel hidden">
      <div class="debug-header">
        <h4>Embassy Health Monitor</h4>
        <button id="copy-debug-btn" class="btn-copy-debug" title="Copy All Debug Info">üìã Copy All</button>
      </div>
      
      <!-- Health Status Grid -->
      <div class="debug-section health-grid">
        <div class="health-item">
          <span class="health-label">Login Enforcement:</span>
          <span id="health-login" class="health-value">--</span>
        </div>
        <div class="health-item">
          <span class="health-label">Session Countdown:</span>
          <span id="health-countdown" class="health-value">--</span>
        </div>
        <div class="health-item">
          <span class="health-label">Auto-Expiry:</span>
          <span id="health-expiry" class="health-value">--</span>
        </div>
        <div class="health-item">
          <span class="health-label">AJAX Calendar:</span>
          <span id="health-ajax-calendar" class="health-value">--</span>
        </div>
        <div class="health-item">
          <span class="health-label">AJAX Slots:</span>
          <span id="health-ajax-slots" class="health-value">--</span>
        </div>
        <div class="health-item">
          <span class="health-label">DOM Mutation:</span>
          <span id="health-dom-mutation" class="health-value">--</span>
        </div>
        <div class="health-item">
          <span class="health-label">Random Delays:</span>
          <span id="health-delays" class="health-value">--</span>
        </div>
        <div class="health-item">
          <span class="health-label">No-Availability:</span>
          <span id="health-no-avail" class="health-value">--</span>
        </div>
      </div>
      
      <div class="debug-section">
        <strong>Session Token:</strong>
        <div id="debug-session-status" style="font-size: 0.65rem; color: #9ca3af; word-break: break-all;">--</div>
      </div>
      
      <div class="debug-section">
        <strong>AJAX Load Stages:</strong>
        <div id="debug-ajax-stages"><em style="color: #9ca3af;">Waiting for activity...</em></div>
      </div>
      <div class="debug-section">
        <strong>Server Response:</strong>
        <pre id="debug-server-json" style="max-height: 150px; overflow: auto;">--</pre>
      </div>
      <div id="copy-success-msg" class="copy-success hidden">‚úì Copied to clipboard!</div>
    </div>

    <div class="embassy-footer-toggle">
      <label class="toggle">
        <input type="checkbox" id="embassy-debug-toggle">
        <span>Embassy Debug Mode</span>
      </label>
    </div>
  </div>

  <script src="dashboard.js"></script>
</body>
</html>
