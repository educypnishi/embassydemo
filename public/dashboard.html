<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Universal Visa Portal Simulator v3.0</title>
  <link rel="stylesheet" href="styles.css">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
  <div id="app-root" class="app-root">
    <div class="card embassy-dashboard">
      <div class="embassy-header">
        <h2>Universal Visa Appointment Portal</h2>
        <div class="portal-mode-selector">
          <label for="portal-mode-select" style="font-size: 0.85rem; color: #6b7280; margin-right: 8px;">Portal Mode:</label>
          <select id="portal-mode-select" class="mode-dropdown">
            <option value="us-embassy">US Embassy</option>
            <option value="vfs-global">VFS Global</option>
            <option value="bls-schengen">BLS / Schengen JSON</option>
            <option value="uk-gov">UK GOV</option>
            <option value="canada-vac">Canada VAC</option>
            <option value="australia-immi">Australia Immi</option>
          </select>
        </div>
        <div class="embassy-session-info">
          <span class="session-badge active">‚óè Session Active</span>
          <span id="session-timer">Time: <span id="time-remaining">--:--</span></span>
          <button id="logout-btn" class="btn-link">Logout</button>
        </div>
      </div>

      <div class="filters">
        <div class="form-group">
          <label>Visa Type</label>
          <select id="visa-type-select">
            <option value="Tourist" selected>Tourist</option>
            <option value="Student">Student</option>
            <option value="Work">Work</option>
            <option value="Visit">Visit</option>
          </select>
        </div>
        <div class="form-group">
          <label>Center</label>
          <select id="center-select">
            <option value="DXB" selected>Dubai (DXB)</option>
            <option value="AUH">Abu Dhabi (AUH)</option>
            <option value="ISB">Islamabad (ISB)</option>
            <option value="LHR">Lahore (LHR)</option>
          </select>
        </div>
        <button id="check-appointments-btn" class="btn secondary">
          Check Appointments
        </button>
      </div>

      <!-- Mode-specific UI Elements -->
      
      <!-- UK GOV Multi-Step Form -->
      <div id="uk-gov-form" class="mode-container hidden">
        <div class="uk-steps-header">
          <div class="uk-step" data-step="1"><span class="step-number">1</span> Personal Details</div>
          <div class="uk-step" data-step="2"><span class="step-number">2</span> Passport Info</div>
          <div class="uk-step" data-step="3"><span class="step-number">3</span> Confirmation</div>
        </div>
        <div id="uk-step-content" class="uk-step-content">
          <p>Complete the form to access appointment calendar...</p>
          <button id="uk-next-step-btn" class="btn primary">Next Step</button>
        </div>
      </div>

      <!-- Canada VAC Queue Screen -->
      <div id="canada-queue" class="mode-container hidden">
        <div class="queue-screen">
          <div class="queue-spinner"></div>
          <h3>You are in queue</h3>
          <p id="queue-message">Estimated wait: <span id="queue-time">--</span> seconds</p>
          <p style="font-size: 0.85rem; color: #6b7280;">Please do not refresh the page...</p>
        </div>
      </div>

      <!-- Australia Immi Session Start -->
      <div id="australia-session-start" class="mode-container hidden">
        <div class="australia-start-screen">
          <h3>ImmiAccount Session</h3>
          <p>Click below to establish your appointment session</p>
          <button id="australia-start-btn" class="btn primary">Start Session</button>
          <p style="font-size: 0.75rem; color: #6b7280; margin-top: 12px;">Session establishment may take 1-2 seconds...</p>
        </div>
      </div>

      <!-- BLS JSON Mode Banner -->
      <div id="bls-json-banner" class="mode-container hidden">
        <div class="bls-banner">
          ‚ö†Ô∏è <strong>JSON API Mode:</strong> This portal uses JSON-based calendar. No HTML calendar available.
        </div>
      </div>

      <!-- VFS Global Wrapper (fake iframe) -->
      <div id="vfs-iframe-wrapper" class="mode-container hidden">
        <div class="vfs-outer-frame">
          <div class="vfs-loading-outer" id="vfs-loading-outer">
            <div class="vfs-spinner"></div>
            <p>Loading VFS Portal...</p>
          </div>
          <div class="vfs-inner-frame hidden" id="vfs-inner-frame">
            <div class="vfs-loading-inner" id="vfs-loading-inner">
              <div class="vfs-spinner"></div>
              <p>Please wait...</p>
            </div>
          </div>
        </div>
      </div>

      <div id="embassy-calendar-wrapper" class="embassy-wrapper">
        <div class="calendar-section">
          <div class="calendar-header">
            <button id="prev-month-btn" class="link-btn">&#8249; Previous</button>
            <div id="calendar-month-label"></div>
            <button id="next-month-btn" class="link-btn">Next &#8250;</button>
          </div>
          
          <div id="calendar-loading" class="calendar-loading">
            <div class="embassy-spinner"></div>
            <p>Loading appointment availability...</p>
          </div>
          
          <div id="appointment-calendar" class="hidden">
            <table id="embassy-calendar" class="embassy-calendar-table">
              <thead>
                <tr>
                  <th>Mon</th>
                  <th>Tue</th>
                  <th>Wed</th>
                  <th>Thu</th>
                  <th>Fri</th>
                  <th>Sat</th>
                  <th>Sun</th>
                </tr>
              </thead>
              <tbody>
                <!-- Dynamically filled by AJAX -->
              </tbody>
            </table>
          </div>
          
          <div class="legend">
            <span class="legend-item available">Available</span>
            <span class="legend-item na">Not Available</span>
            <span class="legend-item full">Full</span>
            <span class="legend-item holiday">Holiday</span>
          </div>
        </div>
      </div>

      <div id="session-expired-popup" class="session-popup hidden">
        <div class="session-popup-inner">
          <h3>Session Expired</h3>
          <p>Your session has expired. Please sign in again.</p>
          <button id="session-expired-ok-btn" class="btn primary">Sign In Again</button>
        </div>
      </div>
    </div>

    <!-- Developer Debug Panel -->
    <div id="embassy-debug-panel" class="debug-panel hidden">
      <div class="debug-header">
        <h4>Embassy Health Monitor</h4>
        <button id="copy-debug-btn" class="btn-copy-debug" title="Copy All Debug Info">üìã Copy All</button>
      </div>
      
      <!-- Active Mode Display -->
      <div class="debug-section">
        <strong>Active Portal Mode:</strong>
        <div id="health-active-mode" style="font-size: 0.8rem; color: #60a5fa; font-weight: 600; margin-top: 4px;">--</div>
      </div>
      
      <!-- Health Status Grid -->
      <div class="debug-section health-grid">
        <div class="health-item">
          <span class="health-label">Login Enforcement:</span>
          <span id="health-login" class="health-value">--</span>
        </div>
        <div class="health-item">
          <span class="health-label">Session Countdown:</span>
          <span id="health-countdown" class="health-value">--</span>
        </div>
        <div class="health-item">
          <span class="health-label">Auto-Expiry:</span>
          <span id="health-expiry" class="health-value">--</span>
        </div>
        <div class="health-item">
          <span class="health-label">AJAX Calendar:</span>
          <span id="health-ajax-calendar" class="health-value">--</span>
        </div>
        <div class="health-item">
          <span class="health-label">AJAX Slots:</span>
          <span id="health-ajax-slots" class="health-value">--</span>
        </div>
        <div class="health-item">
          <span class="health-label">DOM Mutation:</span>
          <span id="health-dom-mutation" class="health-value">--</span>
        </div>
        <div class="health-item">
          <span class="health-label">Random Delays:</span>
          <span id="health-delays" class="health-value">--</span>
        </div>
        <div class="health-item">
          <span class="health-label">No-Availability:</span>
          <span id="health-no-avail" class="health-value">--</span>
        </div>
      </div>
      
      <div class="debug-section">
        <strong>Session Token:</strong>
        <div id="debug-session-status" style="font-size: 0.65rem; color: #9ca3af; word-break: break-all;">--</div>
      </div>
      
      <div class="debug-section">
        <strong>AJAX Load Stages:</strong>
        <div id="debug-ajax-stages"><em style="color: #9ca3af;">Waiting for activity...</em></div>
      </div>
      <div class="debug-section">
        <strong>Server Response:</strong>
        <pre id="debug-server-json" style="max-height: 150px; overflow: auto;">--</pre>
      </div>
      <div id="copy-success-msg" class="copy-success hidden">‚úì Copied to clipboard!</div>
    </div>

    <div class="embassy-footer-toggle">
      <label class="toggle">
        <input type="checkbox" id="embassy-debug-toggle">
        <span>Embassy Debug Mode</span>
      </label>
    </div>
  </div>

  <script src="dashboard.js"></script>
</body>
</html>
